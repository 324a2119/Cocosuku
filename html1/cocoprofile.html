<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† â€” ã‚³ã‚³ã‚¹ã‚¯</title>
<style>
:root {
  --bg:#fff7f9;
  --card:#fff;
  --accent:#ffd1dc;
  --accent2:#ffeeba;
  --text:#444;
  --muted:#888;
  --radius:16px;
  font-family:"Noto Sans JP","Rounded Mplus 1c",sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:var(--bg);color:var(--text);overflow-x:hidden;}
.app{display:flex;flex-direction:column;max-width:600px;margin:0 auto;min-height:100vh;padding-bottom:80px;padding:8px;}
.header-bar{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:16px;padding:8px 8px;}
.brand{display:flex;align-items:center;gap:8px;cursor:pointer;}
.logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.app-name{font-size:20px;font-weight:bold;}
.settings-link{text-decoration:none;color:var(--text);font-weight:bold;font-size:16px;padding:8px;border-radius:12px;background:#eee;}
.profile-card{background:var(--card);padding:20px;border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:16px;}
.profile-header{display:flex;flex-direction:column;align-items:center;margin-bottom:20px;}
.avatar-preview{width:80px;height:80px;background:linear-gradient(45deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:36px;margin-bottom:12px;}
.form-group{margin-bottom:16px;}
.form-group label{display:block;font-size:14px;font-weight:bold;margin-bottom:4px;}
.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:12px;font-size:15px;}
.form-group textarea{resize:vertical;}
.save-btn{width:100%;padding:12px;margin-top:20px;border:none;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent2));font-weight:bold;cursor:pointer;font-size:16px;}
.stats-bar{display:flex;justify-content:space-around;background:var(--card);padding:10px 0;border-radius:var(--radius);box-shadow:0 1px 4px rgba(0,0,0,0.05);margin-bottom:16px;}
.stat-item{text-align:center;font-size:14px;}
.stat-count{font-weight:bold;color:var(--text);font-size:18px;cursor:pointer;}
.my-posts{margin-top:16px;}
.my-posts h3{margin-bottom:10px;}
.post-card{background:var(--card);border-radius:var(--radius);padding:12px;margin-bottom:10px;box-shadow:0 1px 4px rgba(0,0,0,0.05);position:relative;}
.post-card img{max-width:100%;border-radius:10px;margin:6px 0;}
.delete-btn{position:absolute;right:10px;top:10px;background:#ffb8c6;border:none;border-radius:8px;padding:4px 8px;cursor:pointer;font-size:12px;}
.delete-btn:hover{background:#ff99aa;}
.nav-bar{position:fixed;bottom:0;left:0;right:0;height:60px;max-width:600px;margin:0 auto;background:var(--card);box-shadow:0 -2px 6px rgba(0,0,0,0.1);display:flex;justify-content:space-around;align-items:center;border-radius:var(--radius) var(--radius) 0 0;z-index:15;}
.nav-item{flex:1;text-align:center;text-decoration:none;color:var(--muted);font-size:11px;cursor:pointer;padding:8px 0;}
.nav-item.active{color:#ff7fa3;font-weight:bold;}
.nav-item:hover{background:rgba(0,0,0,0.05);border-radius:10px;}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:50;}
.modal{background:var(--card);border-radius:var(--radius);padding:20px;width:90%;max-width:400px;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.modal h3{margin-top:0;font-size:18px;text-align:center;}
.modal-list{max-height:240px;overflow-y:auto;margin-top:12px;border-top:1px solid #eee;padding-top:8px;}
.modal-user{padding:6px 8px;border-bottom:1px solid #f2f2f2;display:flex;align-items:center;gap:10px;cursor:pointer;}
.modal-user:hover{background:#fff2f4;}
.modal-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;}
.close-btn{background:var(--accent);color:white;border:none;padding:8px 14px;border-radius:10px;font-weight:bold;cursor:pointer;display:block;margin:16px auto 0 auto;}
</style>
</head>
<body>
<div class="app">

  <div class="header-bar">
    <div class="brand" onclick="goTimeline()">
        <div class="logo">ã‚³</div>
        <div class="app-name">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
    </div>
    <a href="cocosettings.html" class="settings-link">âš™ï¸ è¨­å®š</a>
  </div>

  <div class="stats-bar">
    <div class="stat-item">
        <div class="stat-count" id="followingCount">0</div>
        <div>ãƒ•ã‚©ãƒ­ãƒ¼</div>
    </div>
    <div class="stat-item">
        <div class="stat-count" id="followerCount">0</div>
        <div>ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</div>
    </div>
    <div class="stat-item">
        <div class="stat-count" id="postCount">0</div>
        <div>æŠ•ç¨¿</div>
    </div>
  </div>

  <div class="profile-card">
    <h3 style="margin-top:0;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h3>
    <div class="profile-header">
        <div class="avatar-preview" id="avatarPreview">ã‚²</div>
    </div>
    
    <div class="form-group"><label for="nameInput">åå‰ï¼ˆå¿…é ˆï¼‰</label><input type="text" id="nameInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚„æœ¬å"></div>
    <div class="form-group"><label for="bioInput">è‡ªå·±ç´¹ä»‹</label><textarea id="bioInput" placeholder="çŸ­ã„è‡ªå·±ç´¹ä»‹æ–‡"></textarea></div>
    <h4 style="margin-top:20px;border-bottom:1px solid #eee;padding-bottom:4px;">è©³ç´°æƒ…å ±</h4>
    <div class="form-group"><label for="hobbyInput">è¶£å‘³</label><input type="text" id="hobbyInput" placeholder="ä¾‹: èª­æ›¸ã€å†™çœŸ"></div>
    <div class="form-group"><label for="circleInput">ã‚µãƒ¼ã‚¯ãƒ«/éƒ¨æ´»</label><input type="text" id="circleInput" placeholder="ä¾‹: ãƒ†ãƒ‹ã‚¹ã‚µãƒ¼ã‚¯ãƒ«"></div>
    <div class="form-group"><label for="courseInput">å­¦éƒ¨/å­¦ç§‘/å°‚æ”»</label><input type="text" id="courseInput" placeholder="ä¾‹: æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ å­¦ç§‘"></div>
    <div class="form-group"><label for="gradeInput">å­¦å¹´</label><input type="text" id="gradeInput" placeholder="ä¾‹: 1å¹´"></div>
    <div class="form-group"><label for="qualificationInput">è³‡æ ¼</label><input type="text" id="qualificationInput" placeholder="ä¾‹: åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“ åˆæ ¼"></div>
    <div class="form-group"><label for="commentInput">ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆ</label><input type="text" id="commentInput" placeholder="ä¾‹: ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼"></div>
    <button class="save-btn" onclick="saveProfile()">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜</button>
  </div>

  <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="profile-card">
    <h3 style="margin-top:0;">æ–°ã—ã„æŠ•ç¨¿</h3>
    <div class="form-group">
      <label for="postText">æŠ•ç¨¿å†…å®¹</label>
      <textarea id="postText" placeholder="ä½•ã‚’æŠ•ç¨¿ã—ã¾ã™ã‹ï¼Ÿ"></textarea>
    </div>
    <div class="form-group">
      <label for="postImages">ç”»åƒï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
      <input type="file" id="postImages" multiple accept="image/*">
    </div>
    <button class="save-btn" onclick="addPost()">æŠ•ç¨¿ã™ã‚‹</button>
  </div>

  <div class="my-posts" id="myPosts"></div>

  <!-- â–¼ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="followModal" class="modal-overlay">
    <div class="modal">
      <h3 id="modalTitle">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
      <div id="followList" class="modal-list"></div>
      <button class="close-btn" onclick="closeFollowModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div class="nav-bar">
    <a href="cocotimeline.html" class="nav-item">ğŸ  TL</a>
    <a href="cocosearch.html" class="nav-item">ğŸ” æ¤œç´¢</a>
    <a href="coconotifications.html" class="nav-item">ğŸ”” é€šçŸ¥</a>
    <a href="cocochat.html" class="nav-item">ğŸ’¬ DM</a>
    <a href="cocoprofile.html" class="nav-item active">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
    <a href="cococalendar.html" class="nav-item">ğŸ“… äºˆå®š</a>
  </div>
</div>

<script>
let myProfile = JSON.parse(localStorage.getItem("profile") || '{"name":"ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼","avatar":"ã‚²"}');
let follows = JSON.parse(localStorage.getItem("follows") || "{}");
let posts = JSON.parse(localStorage.getItem("posts") || "[]");

const nameInput=document.getElementById("nameInput"),
bioInput=document.getElementById("bioInput"),
hobbyInput=document.getElementById("hobbyInput"),
circleInput=document.getElementById("circleInput"),
courseInput=document.getElementById("courseInput"),
qualificationInput=document.getElementById("qualificationInput"),
gradeInput=document.getElementById("gradeInput"),
commentInput=document.getElementById("commentInput"),
avatarPreview=document.getElementById("avatarPreview"),
followingCount=document.getElementById("followingCount"),
followerCount=document.getElementById("followerCount"),
postCount=document.getElementById("postCount"),
postListContainer=document.getElementById("myPosts");

if(!localStorage.getItem("isLoggedIn"))window.location.href="cocologin.html";

function goTimeline(){window.location.href="cocotimeline.html";}

function loadProfile(){
  const p=JSON.parse(localStorage.getItem("profile"));
  if(p){
    nameInput.value=p.name||"";
    bioInput.value=p.bio||"";
    hobbyInput.value=p.hobby||"";
    circleInput.value=p.circle||"";
    courseInput.value=p.course||"";
    qualificationInput.value=p.qualification||"";
    gradeInput.value=p.grade||"";
    commentInput.value=p.comment||"";
    avatarPreview.textContent=p.avatar;
    myProfile=p;
    updateStats();
  }
}

function saveProfile(){
  const p={
    name:nameInput.value.trim(),
    bio:bioInput.value.trim(),
    hobby:hobbyInput.value.trim(),
    circle:circleInput.value.trim(),
    course:courseInput.value.trim(),
    qualification:qualificationInput.value.trim(),
    grade:gradeInput.value.trim(),
    comment:commentInput.value.trim(),
    avatar:nameInput.value.trim()?nameInput.value[0]:"N"
  };
  avatarPreview.textContent=p.avatar;
  localStorage.setItem("profile",JSON.stringify(p));
  myProfile=p;
  updateStats();
  renderMyPosts();
  alert("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
}

// æŠ•ç¨¿è¿½åŠ ï¼ˆç”»åƒå¯¾å¿œï¼‰
function addPost() {
  const text = document.getElementById("postText").value.trim();
  const files = document.getElementById("postImages").files;

  if(!text && files.length === 0){ alert("å†…å®¹ã¾ãŸã¯ç”»åƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }

  const newPost = {
    name: myProfile.name,
    text: text,
    images: [],
    date: new Date().toLocaleString("ja-JP",{hour12:false})
  };

  if(files.length > 0){
    const readers = [];
    for(let i=0;i<files.length;i++){
      readers.push(new Promise(resolve=>{
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.readAsDataURL(files[i]);
      }));
    }
    Promise.all(readers).then(images=>{
      newPost.images = images;
      posts.push(newPost);
      localStorage.setItem("posts",JSON.stringify(posts));
      document.getElementById("postText").value="";
      document.getElementById("postImages").value="";
      renderMyPosts();
    });
  } else {
    posts.push(newPost);
    localStorage.setItem("posts",JSON.stringify(posts));
    document.getElementById("postText").value="";
    renderMyPosts();
  }
  updateStats();
}

function updateStats(){
  if(!follows[myProfile.name])follows[myProfile.name]=[];
  followingCount.textContent=follows[myProfile.name].length;
  let c=0;
  for(const k in follows){ if(follows[k].includes(myProfile.name)) c++; }
  followerCount.textContent=c;
  const m=posts.filter(p=>p.name===myProfile.name).length;
  postCount.textContent=m;
}

function renderMyPosts(){
  postListContainer.innerHTML="<h3>è‡ªåˆ†ã®æŠ•ç¨¿</h3>";
  const m=posts.filter(p=>p.name===myProfile.name);
  if(m.length===0){ postListContainer.innerHTML+="<p style='color:var(--muted);'>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>"; return; }
  m.reverse().forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="post-card";
    let imagesHtml = "";
    if(p.images && Array.isArray(p.images)) imagesHtml = p.images.map(url=>`<img src="${url}">`).join("");
    d.innerHTML = `
      <button class="delete-btn" onclick="deletePost(${i})">ğŸ—‘ï¸å‰Šé™¤</button>
      <div style='font-weight:bold;font-size:14px;'>${p.name}</div>
      <div style='font-size:13px;margin-top:4px;'>${p.text || "(å†…å®¹ãªã—)"}</div>
      ${imagesHtml}
      <div style='text-align:right;font-size:11px;color:var(--muted);margin-top:6px;'>${p.date}</div>
    `;
    postListContainer.appendChild(d);
  });
}

function deletePost(i){
  if(confirm("ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
    const m=posts.filter(p=>p.name===myProfile.name);
    const t=m.reverse()[i];
    posts=posts.filter(p=>p!==t);
    localStorage.setItem("posts",JSON.stringify(posts));
    updateStats();
    renderMyPosts();
    alert("æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
  }
}

// ãƒ•ã‚©ãƒ­ãƒ¼ãƒ»ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«
followingCount.addEventListener("click",()=>openFollowModal("following"));
followerCount.addEventListener("click",()=>openFollowModal("followers"));
function openFollowModal(type){
  const modal=document.getElementById("followModal"),
        list=document.getElementById("followList"),
        title=document.getElementById("modalTitle");
  list.innerHTML="";
  let users=[];
  if(type==="following"){
    title.textContent="ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼";
    users=follows[myProfile.name]||[];
  } else {
    title.textContent="ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼";
    for(const k in follows){ if(follows[k].includes(myProfile.name)) users.push(k); }
  }
  if(users.length===0){ list.innerHTML=`<p style='text-align:center;color:var(--muted);margin:8px 0;'>${type==="following"?"ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚":"ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚"}</p>`; }
  else{ users.forEach(u=>{ const div=document.createElement("div"); div.className="modal-user"; div.innerHTML=`<div class='modal-avatar'>${u[0]}</div><div>${u}</div>`; div.onclick=()=>{window.location.href='cocootherprofile.html?user='+encodeURIComponent(u);}; list.appendChild(div); }); }
  modal.style.display="flex";
}
function closeFollowModal(){document.getElementById("followModal").style.display="none";}
window.addEventListener('load',()=>{loadProfile();renderMyPosts();});
</script>
</body>
</html>
