<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DM â€” ã‚³ã‚³ã‚¹ã‚¯</title>
<style>
:root{
  --bg:#fff7f9;
  --card:#fff;
  --accent:#ffd1dc;
  --accent2:#ffeeba;
  --text:#444;
  --muted:#888;
  --radius:16px;
  font-family:"Noto Sans JP","Rounded Mplus 1c",sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:var(--bg);color:var(--text);overflow-x:hidden;}
.app{display:flex;flex-direction:column;max-width:600px;margin:0 auto;min-height:100vh;padding:8px;padding-bottom:80px;} /* padding-bottomã§ãƒŠãƒ“ãƒãƒ¼ã®é ˜åŸŸã‚’ç¢ºä¿ */
.brand{display:flex;align-items:center;gap:8px;margin-bottom:8px;cursor:pointer;}
.logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.app-name{font-size:20px;font-weight:bold;color:#444;}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  padding:8px 0;
  border-bottom:1px solid #eee;
}
.header-title{font-size:24px;font-weight:bold;}

/* --- DMãƒªã‚¹ãƒˆï¼ˆä¿®æ­£éƒ¨åˆ†ï¼‰ --- */
.dm-list-container{
  flex:1;
}
.dm-item{
  display:flex;
  align-items:center;
  padding:12px;
  background:var(--card);
  border-radius:var(--radius);
  margin-bottom:8px;
  cursor:pointer;
  transition:background-color 0.2s;
  box-shadow:0 1px 4px rgba(0,0,0,0.05);
}
.dm-item:hover{
  background:var(--bg);
}
.dm-avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  background-color:#ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#fff;
  font-size:18px;
  margin-right:12px;
  flex-shrink:0;
}
.dm-info{
  flex:1;
  min-width:0;
}
.dm-name{
  font-weight:bold;
  font-size:16px;
  color:var(--text);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.dm-preview{
  font-size:13px;
  color:var(--muted);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.dm-time{
  font-size:12px;
  color:var(--muted);
  flex-shrink:0;
}


/* --- ãƒãƒ£ãƒƒãƒˆç”»é¢ --- */
#chatScreen{
  display:none;
  flex-direction:column;
  flex:1;
  position:relative;
}
.chat-header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 0;
  border-bottom:1px solid #eee;
}
.back-btn{
  background:none;
  border:none;
  font-size:24px;
  cursor:pointer;
  color:var(--muted);
}
.chat-title{
  font-size:20px;
  font-weight:bold;
}
.chat-container{
  flex:1;
  overflow-y:auto;
  padding:10px 0;
  display:flex;
  flex-direction:column;
}
.message-wrapper{
  display:flex;
  margin-bottom:8px;
  align-items:flex-end;
}
.message{
  max-width:70%;
  padding:10px 14px;
  border-radius:var(--radius);
  line-height:1.4;
  word-wrap:break-word;
}
.message.you{
  background:var(--accent);
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.message.them{
  background:var(--card);
  border:1px solid #eee;
  border-bottom-left-radius:4px;
}
.message-wrapper.them{
  margin-right:auto;
}
.chat-avatar{
  width:32px;
  height:32px;
  border-radius:50%;
  margin-right:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#fff;
  font-size:16px;
  flex-shrink:0;
}

.chat-input-area{
  display:flex;
  gap:8px;
  padding-top:8px;
  border-top:1px solid #eee;
  margin-top:auto;
  position:relative;
}
.chat-input{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:1px solid #ddd;
  font-size:16px;
}
.send-btn{
  background:linear-gradient(180deg,var(--accent),var(--accent2));
  border:none;
  border-radius:20px;
  padding:0 16px;
  font-weight:bold;
  color:#444;
  cursor:pointer;
  transition:0.2s;
  box-shadow:0 2px 4px rgba(0,0,0,0.1);
}
.send-btn:hover{
  opacity:0.9;
}


/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ (æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜) */
.nav-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:60px;
  max-width:600px;
  margin:0 auto;
  background:var(--card);
  box-shadow:0 -2px 6px rgba(0,0,0,0.1);
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-radius:var(--radius) var(--radius) 0 0;
  z-index:15;
}
.nav-item{
  flex:1;
  text-align:center;
  text-decoration:none;
  color:var(--muted);
  font-size:11px;
  cursor:pointer;
  padding:8px 0;
}
.nav-item.active{
  color:#ff7fa3;
  font-weight:bold;
}
</style>
</head>
<body>
<div class="app">
  <div class="brand" onclick="window.location.href='cocotimeline.html'">
    <div class="logo">Co</div>
    <div class="app-name">ã‚³ã‚³ã‚¹ã‚¯</div>
  </div>

  <div id="dmListScreen">
    <div class="header">
        <div class="header-title">DM</div>
    </div>
    
    <div class="dm-list-container" id="dmListContainer">
        </div>
  </div>

  <div id="chatScreen">
    <div class="chat-header">
      <button class="back-btn" onclick="showDmList()">â—€</button>
      <div class="chat-title" id="chatTitle"></div>
    </div>
    <div class="chat-container" id="chatContainer">
      </div>
    <div class="chat-input-area">
      <input type="text" id="chatInput" class="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
      <button class="send-btn" onclick="sendMessage()">é€ä¿¡</button>
    </div>
  </div>
</div>

<div class="nav-bar">
    <a href="cocotimeline.html" class="nav-item">ğŸ  TL</a>
    <a href="cocosearch.html" class="nav-item">ğŸ” æ¤œç´¢</a>
    <a href="coconotifications.html" class="nav-item">ğŸ”” é€šçŸ¥</a>
    <a href="cocochat.html" class="nav-item active">ğŸ’¬ DM</a>
    <a href="cocoprofile.html" class="nav-item">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
    <a href="cococalendar.html" class="nav-item">ğŸ“… äºˆå®š</a>
</div>

<script>
// ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¨ãƒãƒ£ãƒƒãƒˆå±¥æ­´ï¼‰
const mockProfiles = {
    "ãŸã‘ã£ã¡ã‚‡": { avatar: "ãŸ", color: "#ffd1dc", lastMessage: "ã­ãˆã€ä»Šåº¦ã®ã‚¤ãƒ™ãƒ³ãƒˆã£ã¦...", time: "10:30" },
    "ãã‚‰": { avatar: "ã", color: "#a0d1ff", lastMessage: "è‡ªå‹•è¿”ä¿¡: ã™ã†ã¯ã...ã‚“ã€‚", time: "æ˜¨æ—¥" },
    "ã¿ã‹ã‚“": { avatar: "ã¿", color: "#ffaa7f", lastMessage: "å…ƒæ°—ã«ã—ã¦ã‚‹ï¼Ÿ", time: "2æ—¥å‰" }
};
let chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || {
    "ãŸã‘ã£ã¡ã‚‡": [{from:"them", text:"ä»Šæ—¥ã®æˆæ¥­ã©ã†ã ã£ãŸï¼Ÿ"}],
    "ãã‚‰": [{from:"them", text:"èª²é¡ŒãŠã‚ã£ãŸï¼Ÿ"}, {from:"you", text:"ã¾ã ã ã‚ˆãƒ¼"}],
    "ã¿ã‹ã‚“": []
};
let currentUser = null; // ç¾åœ¨ãƒãƒ£ãƒƒãƒˆã—ã¦ã„ã‚‹ç›¸æ‰‹

const dmListScreen = document.getElementById("dmListScreen");
const dmListContainer = document.getElementById("dmListContainer");
const chatScreen = document.getElementById("chatScreen");
const chatTitle = document.getElementById("chatTitle");
const chatContainer = document.getElementById("chatContainer");
const chatInput = document.getElementById("chatInput");

// ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
function renderDmList() {
    dmListContainer.innerHTML = "";
    const users = Object.keys(mockProfiles);

    users.forEach(name => {
        const profile = mockProfiles[name];
        const history = chatHistory[name] || [];
        const lastMsg = history.length > 0 ? history[history.length - 1].text : "ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“";
        const lastTime = profile.time; // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¢ãƒƒã‚¯æ™‚é–“

        const item = document.createElement("div");
        item.className = "dm-item";
        item.onclick = () => selectUser(name);
        
        item.innerHTML = `
            <div class="dm-avatar" style="background-color:${profile.color};">${profile.avatar}</div>
            <div class="dm-info">
                <div class="dm-name">${name}</div>
                <div class="dm-preview">${lastMsg}</div>
            </div>
            <div class="dm-time">${lastTime}</div>
        `;
        dmListContainer.appendChild(item);
    });
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã€ãƒãƒ£ãƒƒãƒˆç”»é¢ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
function selectUser(name) {
    currentUser = name;
    chatTitle.textContent = name;
    dmListScreen.style.display = "none";
    chatScreen.style.display = "flex";
    renderChat();
    chatInput.focus();
}

// DMãƒªã‚¹ãƒˆç”»é¢ã«æˆ»ã‚‹
function showDmList() {
    currentUser = null;
    chatScreen.style.display = "none";
    dmListScreen.style.display = "block";
    renderDmList(); // å¿µã®ãŸã‚ãƒªã‚¹ãƒˆã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
}

// ãƒãƒ£ãƒƒãƒˆç”»é¢ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
function renderChat() {
    chatContainer.innerHTML = "";
    if (!currentUser) return;

    const profile = mockProfiles[currentUser];
    const history = chatHistory[currentUser] || [];

    history.forEach((msg, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "message-wrapper " + msg.from;
        
        const messageDiv = document.createElement("div");
        messageDiv.className = "message " + msg.from;
        messageDiv.textContent = msg.text;
        
        if (msg.from === "them") {
            // ç›¸æ‰‹ã®ã‚¢ãƒã‚¿ãƒ¼
            const img = document.createElement("div");
            img.className = "chat-avatar";
            img.style.backgroundColor = profile.color;
            img.textContent = profile.avatar;
            wrapper.appendChild(img);
            wrapper.appendChild(messageDiv);
        } else {
            // è‡ªåˆ†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å³å¯„ã›
            wrapper.appendChild(messageDiv);
        }
        chatContainer.appendChild(wrapper);
    });

    // æœ€ä¸‹éƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    setTimeout(() => { chatContainer.scrollTop = chatContainer.scrollHeight; }, 10);
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹
function sendMessage() {
    const text = chatInput.value.trim();
    if (!text) return;
    if (!currentUser) return alert("ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");

    const msg = {from:"you", text};
    
    // å±¥æ­´ã‚’åˆæœŸåŒ–
    if (!chatHistory[currentUser]) chatHistory[currentUser] = [];

    chatHistory[currentUser].push(msg);
    localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
    
    chatInput.value = "";
    chatInput.focus();
    renderChat();

    // è‡ªå‹•è¿”ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    setTimeout(() => {
        const reply = {from:"them", text: "è‡ªå‹•è¿”ä¿¡: " + text.split("").reverse().join("")};
        chatHistory[currentUser].push(reply);
        localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
        renderChat();
    }, 1000);
}

// Enterã‚­ãƒ¼ã§ã®é€ä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹
chatInput.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        e.preventDefault(); // æ”¹è¡Œã‚’é˜²ã
        sendMessage();
    }
});

// åˆæœŸè¡¨ç¤º
window.addEventListener('load', () => {
    renderDmList();
});
</script>
</body>
</html>