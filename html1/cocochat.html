<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DM â€” ã‚³ã‚³ã‚¹ã‚¯</title>
<style>
:root{
  --bg:#fff7f9;
  --card:#fff;
  --accent:#ffd1dc;
  --accent2:#ffeeba;
  --text:#444;
  --radius:16px;
  font-family:"Noto Sans JP","Rounded Mplus 1c",sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:var(--bg);color:var(--text);overflow-x:hidden;}
.app{display:flex;flex-direction:column;max-width:600px;margin:0 auto;height:100vh;}
.brand{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:0 8px;cursor:pointer;}
.logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.app-name{font-size:20px;font-weight:bold;color:#444;}
.chat-header{display:flex;align-items:center;gap:4px;margin-bottom:8px;padding:0 8px;position:relative;}
.chat-header img{width:36px;height:36px;border-radius:50%;background:var(--accent);}
.chat-header input{flex:1;padding:8px;border-radius:12px;border:1px solid #ddd;}
.chat-header select{flex:1;padding:8px;border-radius:12px;border:1px solid #ddd;}
.chat-header input:focus, .chat-header select:focus{outline:none;border-color:#ff7fa3;}
.suggestion-box{
  position:absolute;
  top:48px;
  left:48px;
  right:8px;
  background:white;
  border:1px solid #ddd;
  border-radius:12px;
  max-height:150px;
  overflow-y:auto;
  z-index:10;
}
.suggestion-box div{
  padding:8px;
  cursor:pointer;
}
.suggestion-box div:hover{
  background:#ffeeba;
}
.chat-container{flex:1;overflow-y:auto;padding:0 8px;margin-bottom:144px; display:flex; flex-direction:column;word-break: break-word;}
.message-wrapper{display:flex;align-items:flex-start;margin:6px 0;max-width:100%;}
.message-wrapper.you{justify-content:flex-end;}
.message-wrapper.them img{width:28px;height:28px;border-radius:50%;margin-right:6px;background:var(--accent);}
.message{background:var(--card);padding:10px;border-radius:12px;max-width:80%;word-break: break-word;}
.message.you{background:var(--accent2);}
.composer-container{position:fixed;bottom:56px; left:0;width:100%;background:var(--bg);padding:8px 16px;box-shadow:0 -2px 8px rgba(0,0,0,0.1);display:flex;gap:8px;z-index:10;}
.composer-container input{flex:1;padding:10px;border-radius:12px;border:1px solid #ddd;}
.composer-container input:focus{outline:none;border-color:#ff7fa3;}
.composer-container button{padding:10px;border:none;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent2));cursor:pointer;}
.composer-container button:active{opacity:0.8;}
.nav{position:fixed;bottom:0;left:0;width:100%;height:56px;background:var(--card);border-top:1px solid #f0f0f0;display:flex;justify-content:space-around;align-items:center;box-shadow:0 -2px 8px rgba(0,0,0,0.05);}
.nav button{background:transparent;border:none;font-size:22px;color:#888;cursor:pointer;}
.nav button.active{color:#ff7fa3;}
</style>
</head>
<body>
<div class="app">
  <div class="brand" onclick="goTimeline()">
    <div class="logo">Co</div>
    <div class="app-name">ã‚³ã‚³ã‚¹ã‚¯</div>
  </div>

  <!-- ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹é¸æŠ -->
  <div class="chat-header">
    <img id="userAvatar" src="" alt="avatar">
    <input type="text" id="chatUserInput" placeholder="åå‰ã‚’å…¥åŠ›" oninput="showSuggestions()">
    <select id="chatUserSelect" onchange="selectFromDropdown()">
      <option value="">ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‹ã‚‰é¸æŠ</option>
      <option value="å¤©æ± æ¸š">å¤©æ± æ¸š</option>
      <option value="é»’å´">é»’å´</option>
    </select>
    <button onclick="switchUser()">åˆ‡ã‚Šæ›¿ãˆ</button>
    <div id="suggestionBox" class="suggestion-box" style="display:none;"></div>
  </div>

  <div class="chat-container" id="chatContainer"></div>
</div>

<div class="composer-container">
  <input type="text" id="chatInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" onkeydown="if(event.key==='Enter'){sendMessage();}">
  <button onclick="sendMessage()">é€ä¿¡</button>
</div>

<nav class="nav">
  <button onclick="goTimeline()">ğŸ </button>
  <button onclick="goCalendar()">ğŸ“…</button>
  <button class="active">ğŸ’Œ</button>
  <button onclick="goProfile()">ğŸ‘¤</button>
</nav>

<script>
let chatContainer = document.getElementById("chatContainer");
let chatInput = document.getElementById("chatInput");
let chatUserInput = document.getElementById("chatUserInput");
let chatUserSelect = document.getElementById("chatUserSelect");
let userAvatar = document.getElementById("userAvatar");
let suggestionBox = document.getElementById("suggestionBox");

let currentUser = "";
let chatHistory = JSON.parse(localStorage.getItem("chatHistory") || "{}");

// åˆæœŸãƒ‡ãƒ¼ã‚¿
if(!chatHistory["å¤©æ± æ¸š"]) chatHistory["å¤©æ± æ¸š"]=[{from:"them", text:"ã‚„ã£ã»ãƒ¼ï¼ä»Šæ—¥ã‚‚é ‘å¼µã‚ã†ã­ğŸŒ¸"}];
if(!chatHistory["é»’å´"]) chatHistory["é»’å´"]=[{from:"them", text:"ã“ã‚“ã«ã¡ã¯ã€ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ï¼"}];
localStorage.setItem("chatHistory", JSON.stringify(chatHistory));

// ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠæ™‚ã«å…¥åŠ›æ¬„ã‚‚æ›´æ–°
function selectFromDropdown(){
  chatUserInput.value = chatUserSelect.value;
  suggestionBox.style.display="none";
}

// å…¥åŠ›æ™‚ã®äºˆæ¸¬
function showSuggestions(){
  const val = chatUserInput.value.trim();
  if(!val){
    suggestionBox.style.display="none";
    return;
  }
  const names = Object.keys(chatHistory);
  const matches = names.filter(n=>n.startsWith(val));
  if(matches.length===0){
    suggestionBox.style.display="none";
    return;
  }
  suggestionBox.innerHTML="";
  matches.forEach(n=>{
    const div = document.createElement("div");
    div.textContent = n;
    div.onclick = ()=>{
      chatUserInput.value=n;
      suggestionBox.style.display="none";
    };
    suggestionBox.appendChild(div);
  });
  suggestionBox.style.display="block";
}

// åˆ‡æ›¿
function switchUser(){
  currentUser = chatUserInput.value.trim();
  if(!currentUser) return alert("ç›¸æ‰‹ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
  userAvatar.style.backgroundColor = currentUser==="å¤©æ± æ¸š"?"#ffd1dc":currentUser==="é»’å´"?"#a0d1ff":"#ccc";
  if(!chatHistory[currentUser]) chatHistory[currentUser]=[];
  renderChat();
  suggestionBox.style.display="none";
}

// ãƒãƒ£ãƒƒãƒˆæç”»
function renderChat(){
  chatContainer.innerHTML="";
  if(!currentUser) return;
  chatHistory[currentUser].forEach(msg=>{
    const wrapper = document.createElement("div");
    wrapper.className = msg.from==="you"?"message-wrapper you":"message-wrapper them";
    const messageDiv = document.createElement("div");
    messageDiv.className = msg.from==="you"?"message you":"message";
    messageDiv.textContent = msg.text;
    if(msg.from==="them"){
      const img = document.createElement("img");
      img.style.backgroundColor=currentUser==="å¤©æ± æ¸š"?"#ffd1dc":currentUser==="é»’å´"?"#a0d1ff":"#ccc";
      wrapper.appendChild(img);
      wrapper.appendChild(messageDiv);
    }else{
      wrapper.appendChild(messageDiv);
    }
    chatContainer.appendChild(wrapper);
  });
  setTimeout(()=>{ chatContainer.scrollTop = chatContainer.scrollHeight; },10);
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
function sendMessage(){
  const text = chatInput.value.trim();
  if(!text) return;
  if(!currentUser) return alert("ã¾ãšãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");
  const msg = {from:"you", text};
  chatHistory[currentUser].push(msg);
  localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
  chatInput.value="";
  chatInput.focus();
  renderChat();

  setTimeout(()=>{
    const reply = {from:"them", text:"è‡ªå‹•è¿”ä¿¡: "+text.split("").reverse().join("")};
    chatHistory[currentUser].push(reply);
    localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
    renderChat();
  },1000);
}

function goTimeline(){ window.location.href="timeline.html"; }
function goCalendar(){ window.location.href="calendar.html"; }
function goProfile(){ window.location.href="profile.html"; }

window.addEventListener('resize', ()=> { chatContainer.scrollTop = chatContainer.scrollHeight; });
</script>
</body>
</html>
