<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« â€” ã‚³ã‚³ã‚¹ã‚¯</title>
<style>
:root {
  --bg:#fff7f9;
  --card:#fff;
  --accent:#ffd1dc;
  --accent2:#ffeeba;
  --text:#444;
  --muted:#888;
  --radius:16px;
  font-family:"Noto Sans JP","Rounded Mplus 1c",sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:var(--bg);color:var(--text);overflow-x:hidden;}
.app{display:flex;flex-direction:column;max-width:600px;margin:0 auto;min-height:100vh;padding-bottom:80px;padding:8px;}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    margin-bottom:16px;
    padding:8px 8px; 
}
.brand{display:flex;align-items:center;gap:8px;cursor:pointer;}
.logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.app-name{font-size:20px; font-weight:bold;}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
.profile-area{
    display:flex;
    flex-direction:column;
    align-items:center;
    background:var(--card);
    padding:20px;
    border-radius:var(--radius);
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
    margin-bottom:20px;
}
.profile-icon{
    width:80px;
    height:80px;
    background:linear-gradient(45deg, #a0d1ff, #c3e2ff); /* åˆ¥ã®è‰² */
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
    color:#fff;
    font-size:36px;
    margin-bottom:12px;
}
.profile-name{
    font-size:24px;
    font-weight:bold;
    margin-bottom:4px;
}
.profile-bio{
    color:var(--muted);
    font-size:15px;
    margin-bottom:16px;
}
.stats-bar{
    display:flex;
    gap:20px;
}
.stat-item{
    text-align:center;
    font-size:14px;
}
.stat-count{
    font-weight:bold;
    color:var(--text);
    font-size:18px;
}
.action-btn-group{
    display:flex;
    gap:10px;
    margin-top:16px;
}
.follow-btn{
    padding:8px 20px;
    border:1px solid var(--accent);
    border-radius:12px;
    background:var(--accent);
    color:var(--text);
    font-weight:bold;
    cursor:pointer;
}
.follow-btn.following{
    background:#fff;
    color:var(--text);
}
.dm-btn{
    padding:8px 20px;
    border:1px solid #ddd;
    border-radius:12px;
    background:#fff;
    color:var(--text);
    font-weight:bold;
    cursor:pointer;
}


/* æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ (TLã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«) */
.post-card{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  margin-bottom:16px;
}
.post-header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
}
.icon{
  width:40px;
  height:40px;
  background:#ffeeba;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:var(--text);
  font-size:16px;
  cursor:pointer;
}
.user-name{
  font-weight:bold;
  cursor:default;
}
.time{
  font-size:12px;
  color:var(--muted);
}
.post-content{
  margin-bottom:12px;
  line-height:1.5;
}
.post-image{
  max-width:100%;
  border-radius:10px;
  margin-bottom:12px;
}
.post-footer{
  display:flex;
  align-items:center;
  gap:8px;
}
.like-btn{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  padding:4px;
}
.like-btn.liked{
  color:red;
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ */
.nav-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:60px;
  max-width:600px;
  margin:0 auto;
  background:var(--card);
  box-shadow:0 -2px 6px rgba(0,0,0,0.1);
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-radius:var(--radius) var(--radius) 0 0;
  z-index:15;
}
.nav-item{
  flex:1;
  text-align:center;
  text-decoration:none;
  color:var(--muted);
  font-size:11px; /* 6é …ç›®ã«åˆã‚ã›ã¦ç¸®å° */
  cursor:pointer;
  padding:8px 0;
}
.nav-item.active{
  color:#ff7fa3;
  font-weight:bold;
}
.nav-item:hover{
  background:rgba(0,0,0,0.05);
  border-radius:10px;
}
</style>
</head>
<body>
<div class="app">

  <div class="header-bar">
    <div class="brand" onclick="goTimeline()">
        <div class="logo">ã‚³</div>
        <div class="app-name" id="userNameHeader">...</div>
    </div>
    </div>

  <div class="profile-area">
    <div class="profile-icon" id="profileIcon">?</div>
    <div class="profile-name" id="profileName">Loading...</div>
    <div class="profile-bio" id="profileBio"></div>
    
    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-count" id="followingCount">0</div>
            <div>ãƒ•ã‚©ãƒ­ãƒ¼</div>
        </div>
        <div class="stat-item">
            <div class="stat-count" id="followerCount">0</div>
            <div>ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</div>
        </div>
        <div class="stat-item">
            <div class="stat-count" id="postCount">0</div>
            <div>æŠ•ç¨¿</div>
        </div>
    </div>
    
    <div class="action-btn-group">
        <button class="follow-btn" id="followBtn" onclick="toggleFollow()">ãƒ•ã‚©ãƒ­ãƒ¼</button>
        <button class="dm-btn" onclick="startChat()">ğŸ’¬ DMã‚’é€ã‚‹</button>
    </div>
  </div>

  <h3 style="margin-top:0;">æŠ•ç¨¿ä¸€è¦§</h3>
  <div id="userPostsDiv">
    <div style="text-align:center; color:var(--muted); margin-top:20px;">æŠ•ç¨¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <div class="nav-bar">
    <a href="cocotimeline.html" class="nav-item">ğŸ  TL</a>
    <a href="cocosearch.html" class="nav-item">ğŸ” æ¤œç´¢</a>
    <a href="coconotifications.html" class="nav-item">ğŸ”” é€šçŸ¥</a>
    <a href="cocochat.html" class="nav-item">ğŸ’¬ DM</a>
    <a href="cocoprofile.html" class="nav-item">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
    <a href="cococalendar.html" class="nav-item">ğŸ“… äºˆå®š</a>
  </div>
</div>

<script>
let posts = JSON.parse(localStorage.getItem("posts") || "[]");
let follows = JSON.parse(localStorage.getItem("follows") || "{}");
let myProfile = JSON.parse(localStorage.getItem("profile") || '{"name":"ã‚²ã‚¹ãƒˆ","avatar":"ã‚²"}');

// ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
if (!localStorage.getItem("isLoggedIn")) {
    window.location.href = "cocologin.html";
}

// URLã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
const urlParams = new URLSearchParams(window.location.search);
const userName = urlParams.get('user');

// ãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ (ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã¨ä¸€è‡´ã•ã›ã‚‹)
const mockProfiles = {
    "ãã‚‰": { name: "ãã‚‰", bio: "è¶£å‘³ã¯å†™çœŸã€ã‚µãƒ¼ã‚¯ãƒ«ã¯ãƒ†ãƒ‹ã‚¹ã§ã™ã€‚", avatar: "ã" },
    "ãŸã‘ã£ã¡ã‚‡": { name: "ãŸã‘ã£ã¡ã‚‡", bio: "å‹‰å¼·é ‘å¼µã£ã¦ã¾ã™ï¼", avatar: "ãŸ" },
    "ã¿ã‹ã‚“": { name: "ã¿ã‹ã‚“", bio: "æ–‡å­¦éƒ¨æ‰€å±ã€‚èª­æ›¸ãŒè¶£å‘³ã€‚", avatar: "ã¿" },
    [myProfile.name]: myProfile
};
const userProfile = mockProfiles[userName] || { name: userName, bio: "ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", avatar: userName ? userName[0] : "?" };

// è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
if (userName === myProfile.name) {
    window.location.href = "cocoprofiler.html";
}


const profileIcon = document.getElementById("profileIcon");
const profileName = document.getElementById("profileName");
const profileBio = document.getElementById("profileBio");
const followBtn = document.getElementById("followBtn");
const userPostsDiv = document.getElementById("userPostsDiv");
const followingCount = document.getElementById("followingCount");
const followerCount = document.getElementById("followerCount");
const postCount = document.getElementById("postCount");

profileName.textContent = userProfile.name;
profileIcon.textContent = userProfile.avatar;
profileBio.textContent = userProfile.bio;
document.getElementById("userNameHeader").textContent = userProfile.name;

function goTimeline(){ window.location.href="cocotimeline.html"; }

// ãƒ•ã‚©ãƒ­ãƒ¼çŠ¶æ…‹ã®æ›´æ–°ã¨è¡¨ç¤º
function updateFollowBtn(){
  // è‡ªåˆ†ãŒã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
  const isFollowing = follows[myProfile.name] && follows[myProfile.name].includes(userProfile.name);

  if(isFollowing){
    followBtn.textContent = "ãƒ•ã‚©ãƒ­ãƒ¼ä¸­";
    followBtn.classList.add("following");
  } else {
    followBtn.textContent = "ãƒ•ã‚©ãƒ­ãƒ¼";
    followBtn.classList.remove("following");
  }
}

function toggleFollow(){
  if(!follows[myProfile.name]) follows[myProfile.name] = [];
  const index = follows[myProfile.name].indexOf(userProfile.name);
  if(index>=0){
    follows[myProfile.name].splice(index,1);
  } else {
    follows[myProfile.name].push(userProfile.name);
  }
  localStorage.setItem("follows", JSON.stringify(follows));
  updateFollowBtn();
  updateStats();
}

function startChat(){
    // DMãƒšãƒ¼ã‚¸ã¸é·ç§»ã—ã€ç›¸æ‰‹ã‚’è¨­å®š
    window.location.href = `cocochat.html?target=${encodeURIComponent(userProfile.name)}`;
}

// ãƒ•ã‚©ãƒ­ãƒ¼ãƒ»ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã€æŠ•ç¨¿æ•°ã®æ›´æ–°
function updateStats() {
    if (!follows[userProfile.name]) follows[userProfile.name] = [];
    followingCount.textContent = follows[userProfile.name].length;

    let count = 0;
    for (const key in follows) {
        if (follows[key].includes(userProfile.name)) count++;
    }
    followerCount.textContent = count;
    
    // æŠ•ç¨¿æ•°è¨ˆç®—
    const userPostCount = posts.filter(p => p.name === userProfile.name).length;
    postCount.textContent = userPostCount;
}

// æŠ•ç¨¿ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ã ã‘ï¼‰
function renderUserPosts(){
  if(!userProfile) return;
  const userPosts = posts.filter(p => p.name === userProfile.name);
  userPostsDiv.innerHTML = "";
  if(userPosts.length === 0){
    userPostsDiv.innerHTML = "<div style='color:var(--muted); text-align:center;'>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>";
    return;
  }
  
  // è‡ªåˆ†ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨åŒã˜è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
  userPosts.slice().reverse().forEach((p, index)=>{
    const card = document.createElement("div");
    card.className = "post-card";
    const time = new Date(p.time).toLocaleString("ja-JP",{hour12:false});
    const liked = p.liked ? "liked" : "";
    
    let imageTag = p.image ? `<img src="${p.image}" class="post-image">` : "";

    card.innerHTML = `
      <div class="post-header">
        <div class="icon">${p.avatar}</div>
        <div>
          <div class="user-name">${p.name}</div>
          <div class="time">${time}</div>
        </div>
      </div>
      <div class="post-content">${p.text.replace(/\n/g, '<br>')}</div>
      ${imageTag}
      <div class="post-footer">
        <button class="like-btn ${liked}" onclick="toggleLike(${index})">â¤ï¸</button>
        <span>${p.likes || 0}</span>
      </div>
    `;
    userPostsDiv.appendChild(card);
  });
}

// ã„ã„ã­æ©Ÿèƒ½ (ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ã«é™å®šã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‡¦ç†ã«ä¿®æ­£)
function toggleLike(index){
    const userPosts = posts.filter(p=>p.name===userProfile.name);
    // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ userPosts ã®é€†é †ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰ã€å…ƒã® posts é…åˆ—ã®æŠ•ç¨¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç‰¹å®š
    const targetPost = userPosts[userPosts.length - 1 - index];
    const originalIndex = posts.findIndex(p => p === targetPost);
    
    if (originalIndex !== -1) {
        posts[originalIndex].liked = !posts[originalIndex].liked;
        posts[originalIndex].likes = (posts[originalIndex].likes || 0) + (posts[originalIndex].liked ? 1 : -1);
        localStorage.setItem("posts", JSON.stringify(posts));
        renderUserPosts(); // æŠ•ç¨¿ä¸€è¦§ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    }
}

// åˆæœŸå‡¦ç†
updateFollowBtn();
updateStats();
renderUserPosts();
</script>
</body>
</html>
