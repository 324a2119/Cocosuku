<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>„Éó„É≠„Éï„Ç£„Éº„É´ ‚Äî „Ç≥„Ç≥„Çπ„ÇØ</title>
<style>
:root{
  --bg:#fff7f9;
  --card:#fff;
  --accent:#ffd1dc;
  --accent2:#ffeeba;
  --text:#444;
  --muted:#888;
  --radius:16px;
  font-family:"Noto Sans JP","Rounded Mplus 1c",sans-serif;
}
*{box-sizing:border-box;}
body{margin:0;padding:0;background:var(--bg);color:var(--text);}
.app{display:flex;flex-direction:column;max-width:600px;margin:0 auto;padding:16px;min-height:100vh;}
.brand{display:flex;align-items:center;gap:8px;margin-bottom:8px;cursor:pointer;}
.logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.app-name{font-size:20px;font-weight:bold;}
.profile-card{background:var(--card);padding:24px;margin-bottom:16px;border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,0.08);text-align:center;}
.avatar{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:30px;margin-bottom:12px;box-shadow:0 3px 6px rgba(0,0,0,0.1);}
.name{font-weight:bold;font-size:20px;margin-bottom:4px;}
.bio{font-size:14px;color:var(--muted);margin-bottom:8px;}
.follow-btn{padding:8px 16px;border:none;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent2));color:#444;font-weight:bold;cursor:pointer;transition:0.2s;box-shadow:0 3px 6px rgba(0,0,0,0.1);}
.follow-btn.following{background:#ff7fa3;color:#fff;}
.follow-btn:hover{transform:scale(1.05);}
.feed{display:flex;flex-direction:column;gap:10px;margin-bottom:70px;}
.post-card{background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:relative;}
.post-header{display:flex;align-items:center;gap:8px;margin-bottom:6px;}
.icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:16px;}
.user-name{font-weight:bold;font-size:15px;}
.time{font-size:12px;color:var(--muted);}
.post-content{font-size:14px;margin:6px 0;white-space:pre-wrap;}
.post-image{width:100%;border-radius:12px;margin-top:8px;}
.post-footer{display:flex;align-items:center;gap:16px;color:var(--muted);font-size:14px;}
.like-btn{cursor:pointer;border:none;background:none;font-size:16px;}
.like-btn.liked{color:#ff7fa3;}
.delete-btn{cursor:pointer;border:none;background:none;font-size:14px;color:#ff5555;position:absolute;top:8px;right:8px;}
.delete-btn:hover{text-decoration:underline;}
.nav{position:fixed;bottom:0;left:0;width:100%;background:var(--card);border-top:1px solid #f0f0f0;display:flex;justify-content:space-around;padding:8px 0;box-shadow:0 -2px 8px rgba(0,0,0,0.05);}
.nav button{background:linear-gradient(180deg,var(--accent),var(--accent2));border:none;border-radius:50%;width:44px;height:44px;font-size:22px;color:#444;cursor:pointer;transition:0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.2);}
.nav button:hover{transform:scale(1.1);}
.nav button.active{color:#ff7fa3;}
</style>
</head>
<body>
<div class="app">
  <div class="brand" onclick="goTimeline()">
    <div class="logo">Co</div>
    <div class="app-name">„Ç≥„Ç≥„Çπ„ÇØ</div>
  </div>

  <div class="profile-card">
    <div class="avatar" id="avatar">U</div>
    <div class="name" id="name">„É¶„Éº„Ç∂„ÉºÂêç</div>
    <div class="bio" id="bio">Ëá™Â∑±Á¥π‰ªã</div>
    <button class="follow-btn" id="followBtn">„Éï„Ç©„É≠„Éº</button>
  </div>

  <div class="feed" id="feed"></div>
</div>

<nav class="nav">
  <button onclick="goTimeline()">üè†</button>
  <button onclick="goCalendar()">üìÖ</button>
  <button onclick="goChat()">üíå</button>
  <button class="active">üë§</button>
</nav>

<script>
function goTimeline(){ window.location.href="cocotimeline.html"; }
function goCalendar(){ window.location.href="cococalendar.html"; }
function goChat(){ window.location.href="cocochat.html"; }
function goProfile(){ window.location.href="cocoprofile.html"; }

const urlParams = new URLSearchParams(window.location.search);
const userName = urlParams.get("user");
const allProfiles = JSON.parse(localStorage.getItem("allProfiles") || "[]"); 
const posts = JSON.parse(localStorage.getItem("posts") || "[]");
const currentProfile = JSON.parse(localStorage.getItem("profile") || {name:"Â≠¶ÁîüA", avatar:"A"});

// „Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´ÂèñÂæó
let userProfile = allProfiles.find(p=>p.name===userName) || {name:userName, avatar:userName[0], bio:"Ëá™Â∑±Á¥π‰ªã„Å™„Åó"};

// Ë°®Á§∫
document.getElementById("avatar").textContent = userProfile.avatar;
document.getElementById("name").textContent = userProfile.name;
document.getElementById("bio").textContent = userProfile.bio;

// „Éï„Ç©„É≠„ÉºÊ©üËÉΩ
let following = JSON.parse(localStorage.getItem("following") || "[]");
const followBtn = document.getElementById("followBtn");

function updateFollowBtn(){
  followBtn.textContent = following.includes(userProfile.name) ? "„Éï„Ç©„É≠„Éº‰∏≠" : "„Éï„Ç©„É≠„Éº";
  followBtn.classList.toggle("following", following.includes(userProfile.name));
}

followBtn.addEventListener("click", ()=>{
  if(following.includes(userProfile.name)){
    following = following.filter(n=>n!==userProfile.name);
  } else {
    following.push(userProfile.name);
  }
  localStorage.setItem("following", JSON.stringify(following));
  updateFollowBtn();
});

updateFollowBtn();

// ÊäïÁ®øË°®Á§∫Ôºà„Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÅÆÊäïÁ®ø„ÅÆ„ÅøÔºâ
const feed = document.getElementById("feed");
function renderPosts(){
  const userPosts = posts.filter(p=>p.name===userProfile.name).slice().reverse();
  feed.innerHTML = "";
  if(userPosts.length===0){
    feed.innerHTML = "<div style='text-align:center;color:var(--muted);margin-top:30px;'>„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>";
    return;
  }
  userPosts.forEach((p,index)=>{
    const card = document.createElement("div");
    card.className="post-card";
    const time = new Date(p.time).toLocaleString("ja-JP",{hour12:false});
    const liked = p.liked ? "liked" : "";
    let deleteBtn = "";
    if(p.name === currentProfile.name){
      deleteBtn = `<button class="delete-btn" onclick="deletePost(${index})">ÂâäÈô§</button>`;
    }
    let imageTag = p.image ? `<img src="${p.image}" class="post-image">` : "";
    card.innerHTML = `
      <div class="post-header">
        <div class="icon">${p.avatar}</div>
        <div>
          <div class="user-name">${p.name}</div>
          <div class="time">${time}</div>
        </div>
      </div>
      <div class="post-content">${p.text}</div>
      ${imageTag}
      <div class="post-footer">
        <button class="like-btn ${liked}" onclick="toggleLike(${index})">‚ù§Ô∏è</button>
        <span>${p.likes || 0}</span>
      </div>
      ${deleteBtn}
    `;
    feed.appendChild(card);
  });
}
renderPosts();

// „ÅÑ„ÅÑ„Å≠Ê©üËÉΩ
function toggleLike(index){
  const userPosts = posts.filter(p=>p.name===userProfile.name);
  const revIndex = posts.indexOf(userPosts[userPosts.length-1-index]);
  posts[revIndex].liked = !posts[revIndex].liked;
  posts[revIndex].likes = (posts[revIndex].likes || 0) + (posts[revIndex].liked ? 1 : -1);
  localStorage.setItem("posts", JSON.stringify(posts));
  renderPosts();
}

// ÊäïÁ®øÂâäÈô§
function deletePost(index){
  const userPosts = posts.filter(p=>p.name===userProfile.name);
  const revIndex = posts.indexOf(userPosts[userPosts.length-1-index]);
  if(confirm("„Åì„ÅÆÊäïÁ®ø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")){
    posts.splice(revIndex,1);
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }
}
</script>
</body>
</html>
